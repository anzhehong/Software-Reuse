# 程序文档


# 第一次文档
> 2016.03.30


## 需求分析及概要设计

### 功能需求

该项目要求我们实现从客户端发送消息到服务端，服务端再将收到的消息转发给其他客户端。概括下来主要有以下功能：

- 用户注册（optional）
- 用户登录，服务器进行身份验证
- 登录成功的用户发送消息给服务端，服务端有选择接收消息并转发给其他客户
- 服务器对客户端发来的信息进行限制和过滤
- 记录用户发送的消息和服务端接收的消息
- 断线重连机制


#### 系统用例

根据项目功能，我们设计了如下用例图。

![UseCase](http://7xsf2g.com1.z0.glb.clouddn.com/reuse-Naughty_usecase.png)

其中共有两个User，分为Client和Server。

Client主要的Case有：

1. 请求登录
2. 发送消息
3. 自动重连
4. 记录一些信息

Server主要的Case有：

1. 对Client的登录请求进行验证
2. 接收Client发来的信息
3. 对Client发来的信息进行Validate，合法信息转发其它在线客户端
4. 对client登录状态进行限制，每个session发100次后要求重连
5. 记录一些信息

> 说明：
> 其中'C-S Messages'表示client向server 发送的消息；'S-C'正好与其相反。



### 非功能性需求
> 由于本次项目要求中并没有提及明确的非功能性需求，因此我们在架构中初步考虑了诸如安全性等非功能行需求，但是还未进行实现。

## 架构设计

### 架构图

![](http://7xsf2g.com1.z0.glb.clouddn.com/reuse-architecture2.png)

如上图，我们设计的架构主要可分为三大层：Application Layer、Core Service Layer和Cross-Cutting Layer。

其中，Core Service Layer包含了Message API和Database API两个子系统，分别作为经过我们封装的ActiveMQ的的消息收发组件，以及数据库操作的API。

Application Layer包含了客户端和服务器，是较高级别层次的内容。

Cross-Cutting Layer是在整个系统运行中各层次都会用到的一些功能性、非功能性组件，如安全验证、日志功能、可配置文件以及工具类等。

最终，我们将会抽离出来Core Service 和Cross-Cutting的工具包供Application Layer的Server和Client使用，以完成`高内聚、低耦合`的要求。


### 重要组件的选择及理由
- Apache-Activemq

  1. Server和Client之间消息的传递，我们使用了`apache-activemq`消息中间件中的Queue模式。依其所提供的Producer -> Consumer 消息传递模式，将Server 作为
Consumer，将每一个Client 作为Producer，消息反向传递时consumer和producer互换，实现二者之间消息的互通。

  2. 利用`apache-activemq`的发布订阅模式(`Publish - Subscribe`)建立一个Server对消息的转发机制，即server收到的所有有效信息都会被转发到特定的topic中供subscriber进行接收。
  3. 默认地址是`tcp://localhost:61616`

- JUnit 

  使用了JUnit 4.0 来进行单元测试。
  
- Maven

  我们使用Maven来管理项目依赖，和进行打包。

- Spring+Hibernate

  使用了Spring+Hibernate来搭建项目的基本框架。数据库地址在阿里云服务器。

> 使用这个框架看起来有点大，之所以选择比较完备的项目框架是为了提高后期的可扩展性。


## 代码说明

我们将从：项目结构、命名规范、注释规范、模块调用关系、重要功能和逻辑